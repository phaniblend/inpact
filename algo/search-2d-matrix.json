{
  "id": "search-2d-matrix",
  "title": "Search a 2D Matrix",
  "pattern": "binary-search (flattened view)",
  "difficulty": "medium",
  "language": "javascript",
  "status": "PERFECT",
  "standardsVersion": "lessonStandards.v1",
  "curriculum": {
    "lessonOrderTag": "FOUNDATION-10",
    "introduces": ["2d-to-1d-mapping"],
    "assumesAlreadyTaught": [
      "variables",
      "arrays",
      "indexes",
      "loops",
      "functions",
      "return",
      "comparison",
      "midpoint",
      "binary-search"
    ]
  },
  "pseudocode": [
    { "id": "ps1", "text": "Treat the 2D matrix as a sorted 1D array." },
    { "id": "ps2", "text": "Set left = 0 and right = rows * cols - 1." },
    { "id": "ps3", "text": "While left <= right:" },
    { "id": "ps4", "text": "  mid = floor((left + right) / 2)." },
    { "id": "ps5", "text": "  Convert mid to row = floor(mid / cols), col = mid % cols." },
    { "id": "ps6", "text": "  Compare matrix[row][col] with target and move pointers." },
    { "id": "ps7", "text": "Return true if found, else false." }
  ],
  "flow": [
    {
      "stepId": "lesson-start",
      "mentorSays": "You selected **Search a 2D Matrix**.\n\nThis lesson extends **binary search** to a 2D grid by viewing it as a single sorted list.",
      "action": "next",
      "next": "problem-statement"
    },
    {
      "stepId": "problem-statement",
      "mentorSays": "### Problem\nYou are given a matrix where:\n- each row is sorted\n- the first number of each row is greater than the last number of the previous row\n\nDetermine if a target value exists in the matrix.",
      "example": "matrix = [[1,3,5],[7,9,11]], target = 9",
      "action": "next",
      "next": "tiny-examples"
    },
    {
      "stepId": "tiny-examples",
      "mentorSays": "Tiny examples:\n\n1) [[1,3,5],[7,9,11]], target=9 → true\n2) [[1,3,5],[7,9,11]], target=6 → false",
      "action": "next",
      "next": "key-observation"
    },
    {
      "stepId": "key-observation",
      "mentorSays": "Key observation:\n\nIf we read the matrix row by row, it behaves exactly like a **sorted 1D array**.",
      "action": "next",
      "next": "thinking-challenge"
    },
    {
      "stepId": "thinking-challenge",
      "mentorSays": "Thinking challenge:\n\nIf we pretend the matrix is one long list, how could we use binary search on it?",
      "choices": [
        { "label": "Map 1D index to row and column", "next": "core-idea" },
        { "label": "Search each row separately", "next": "core-idea" }
      ]
    },
    {
      "stepId": "core-idea",
      "mentorSays": "Correct.\n\nWe apply **binary search on indices** and convert them back to row and column positions.",
      "action": "next",
      "next": "index-mapping"
    },
    {
      "stepId": "index-mapping",
      "mentorSays": "### Index mapping\n\nIf the matrix has `cols` columns:\n\n- row = floor(index / cols)\n- col = index % cols\n\nThis tells us where the value lives in the matrix.",
      "action": "next",
      "next": "walkthrough-mini"
    },
    {
      "stepId": "walkthrough-mini",
      "mentorSays": "Mini walkthrough:\n\nmatrix = [[1,3,5],[7,9,11]]\ncols = 3\n\nmid index = 4\nrow = floor(4 / 3) = 1\ncol = 4 % 3 = 1\n\nmatrix[1][1] = 9",
      "action": "next",
      "next": "pseudocode-step"
    },
    {
      "stepId": "pseudocode-step",
      "mentorSays": "### Pseudocode (logic plan)",
      "pseudocodeLineIds": ["ps1", "ps2", "ps3", "ps4", "ps5", "ps6", "ps7"],
      "action": "next",
      "next": "coding-intro"
    },
    {
      "stepId": "coding-intro",
      "mentorSays": "Now we write JavaScript.\n\nThis is binary search with a small index conversion.",
      "action": "next",
      "next": "code-01-function",
      "pseudocodeLineIds": ["ps1"]
    },
    {
      "stepId": "code-01-function",
      "mentorSays": "Step 1: Create the function.",
      "example": "function searchMatrix(matrix, target) {\n\n}",
      "action": "next",
      "next": "code-02-setup",
      "pseudocodeLineIds": ["ps2"]
    },
    {
      "stepId": "code-02-setup",
      "mentorSays": "Step 2: Set up left, right, rows, and columns.",
      "example": "const rows = matrix.length;\nconst cols = matrix[0].length;\nlet left = 0;\nlet right = rows * cols - 1;",
      "action": "next",
      "next": "code-03-loop",
      "pseudocodeLineIds": ["ps3"]
    },
    {
      "stepId": "code-03-loop",
      "mentorSays": "Step 3: Binary search loop.",
      "example": "while (left <= right) {\n\n}",
      "action": "next",
      "next": "code-04-mid-map",
      "pseudocodeLineIds": ["ps4", "ps5"]
    },
    {
      "stepId": "code-04-mid-map",
      "mentorSays": "Step 4: Compute mid and map it to row and column.",
      "example": "const mid = Math.floor((left + right) / 2);\nconst row = Math.floor(mid / cols);\nconst col = mid % cols;",
      "action": "next",
      "next": "code-05-compare",
      "pseudocodeLineIds": ["ps6"]
    },
    {
      "stepId": "code-05-compare",
      "mentorSays": "Step 5: Compare value and move pointers.",
      "example": "const value = matrix[row][col];\nif (value === target) return true;\nif (value < target) left = mid + 1;\nelse right = mid - 1;",
      "action": "next",
      "next": "final-code"
    },
    {
      "stepId": "final-code",
      "mentorSays": "### Final JavaScript code",
      "example": "function searchMatrix(matrix, target) {\n  const rows = matrix.length;\n  const cols = matrix[0].length;\n\n  let left = 0;\n  let right = rows * cols - 1;\n\n  while (left <= right) {\n    const mid = Math.floor((left + right) / 2);\n    const row = Math.floor(mid / cols);\n    const col = mid % cols;\n\n    const value = matrix[row][col];\n\n    if (value === target) return true;\n    if (value < target) left = mid + 1;\n    else right = mid - 1;\n  }\n\n  return false;\n}",
      "action": "next",
      "next": "wrap-up"
    },
    {
      "stepId": "wrap-up",
      "mentorSays": "Wrap-up:\n\nYou learned:\n- how 2D data can be treated as 1D\n- how to reuse binary search with index mapping\n- a powerful technique used in matrix problems\n\nMore matrix-based problems will build on this idea.",
      "action": "complete"
    }
  ]
}
