{
  "id": "subsets-ii",
  "title": "Subsets II",
  "pattern": "backtracking",
  "difficulty": "medium",
  "language": "javascript",
  "status": "draft",
  "flow": [
    {
      "stepId": "title",
      "mentorSays": "At the end of this lesson, you will be able to:\n\n1. Understand what Subsets II asks for\n2. Use backtracking to generate unique subsets\n3. Handle duplicates correctly\n4. Skip duplicate elements during generation\n5. Implement the solution step by step in your chosen language",
      "action": "continue",
      "next": "problem-illustration"
    },
    {
      "stepId": "problem-illustration",
      "mentorSays": "Perfect! Now let's understand what Subsets II is asking.\n\n**Problem Definition:**\nGiven an integer array `nums` that may contain duplicates, return all possible subsets (the power set). The solution set must not contain duplicate subsets.\n\n**Example 1:** nums = [1,2,2]\nUnique subsets: [], [1], [2], [1,2], [2,2], [1,2,2]\nAnswer: [[],[1],[2],[1,2],[2,2],[1,2,2]]\n\n**Key Insight:** Similar to Subsets, but must skip duplicates. Sort first, skip if same element was used at same level.",
      "example": "Example: nums=[1,2,2] → [[],[1],[2],[1,2],[2,2],[1,2,2]]",
      "action": "continue",
      "next": "thinking-challenge"
    },
    {
      "stepId": "thinking-challenge",
      "mentorSays": "How would YOU generate unique subsets with duplicates?",
      "choices": [
        {
          "label": "Use backtracking with duplicate skipping",
          "next": "explore-backtracking"
        },
        {
          "label": "Generate all then remove duplicates",
          "next": "explore-filter"
        },
        {
          "label": "Use set to track seen",
          "next": "explore-set"
        }
      ]
    },
    {
      "stepId": "explore-filter",
      "mentorSays": "That works but is inefficient. Better to skip duplicates during generation.",
      "action": "continue",
      "next": "explore-backtracking"
    },
    {
      "stepId": "explore-set",
      "mentorSays": "Set works but backtracking with sorting is more efficient.",
      "action": "continue",
      "next": "explore-backtracking"
    },
    {
      "stepId": "explore-backtracking",
      "mentorSays": "Backtracking with sorting and duplicate skipping is optimal. Sort first, skip if same element used at same level.",
      "action": "continue",
      "next": "language-selection"
    },
    {
      "stepId": "language-selection",
      "mentorSays": "Great! Now let's code this solution. Which programming language would you like to use?",
      "choices": [
        {
          "label": "JavaScript",
          "next": "variable-check-js"
        },
        {
          "label": "Python",
          "next": "variable-check-python"
        },
        {
          "label": "Java",
          "next": "variable-check-java"
        },
        {
          "label": "C++",
          "next": "variable-check-cpp"
        },
        {
          "label": "TypeScript",
          "next": "variable-check-ts"
        }
      ]
    },
    {
      "stepId": "variable-check-js",
      "mentorSays": "Before we start coding, let me ask: Do you know what a variable is in JavaScript?",
      "choices": [
        {
          "label": "Yes, I know variables",
          "next": "function-check-js"
        },
        {
          "label": "No, explain variables",
          "next": "variable-explanation-js"
        }
      ]
    },
    {
      "stepId": "variable-explanation-js",
      "mentorSays": "A variable is like a labeled box where you can store a value.",
      "example": "let result = [];",
      "action": "continue",
      "next": "function-check-js"
    },
    {
      "stepId": "function-check-js",
      "mentorSays": "Do you know what a function is in JavaScript?",
      "choices": [
        {
          "label": "Yes, I know functions",
          "next": "parameter-check-js"
        },
        {
          "label": "No, explain functions",
          "next": "function-explanation-js"
        }
      ]
    },
    {
      "stepId": "function-explanation-js",
      "mentorSays": "A function is a reusable block of code.",
      "example": "function subsetsWithDup() {}",
      "action": "continue",
      "next": "parameter-check-js"
    },
    {
      "stepId": "parameter-check-js",
      "mentorSays": "Do you know what parameters are?",
      "choices": [
        {
          "label": "Yes, I know parameters",
          "next": "backtracking-check-js"
        },
        {
          "label": "No, explain parameters",
          "next": "parameter-explanation-js"
        }
      ]
    },
    {
      "stepId": "parameter-explanation-js",
      "mentorSays": "Parameters are inputs to a function.",
      "action": "continue",
      "next": "backtracking-check-js"
    },
    {
      "stepId": "backtracking-check-js",
      "mentorSays": "Do you know what backtracking is?",
      "choices": [
        {
          "label": "Yes, I know",
          "next": "coding-start-js"
        },
        {
          "label": "No, explain",
          "next": "backtracking-explanation-js"
        }
      ]
    },
    {
      "stepId": "backtracking-explanation-js",
      "mentorSays": "Backtracking tries choices, explores recursively, backtracks. Skip duplicates at same level.",
      "example": "function backtrack(index, current) { /* skip duplicates */ }",
      "action": "continue",
      "next": "coding-start-js"
    },
    {
      "stepId": "coding-start-js",
      "mentorSays": "Implement subsets II in JS.",
      "example": "function subsetsWithDup(nums) {}",
      "action": "continue",
      "next": "coding-sort-js"
    },
    {
      "stepId": "coding-sort-js",
      "mentorSays": "Sort the array first to group duplicates together.",
      "action": "continue",
      "next": "coding-init-js"
    },
    {
      "stepId": "coding-init-js",
      "mentorSays": "Initialize result array.",
      "action": "continue",
      "next": "coding-helper-js"
    },
    {
      "stepId": "coding-helper-js",
      "mentorSays": "Create backtrack helper function.",
      "action": "continue",
      "next": "coding-base-js"
    },
    {
      "stepId": "coding-base-js",
      "mentorSays": "Add base case: add current subset to result.",
      "action": "continue",
      "next": "coding-loop-js"
    },
    {
      "stepId": "coding-loop-js",
      "mentorSays": "Loop from index to end.",
      "action": "continue",
      "next": "coding-skip-js"
    },
    {
      "stepId": "coding-skip-js",
      "mentorSays": "Skip if same element was used at this level (duplicate check).",
      "action": "continue",
      "next": "coding-recurse-js"
    },
    {
      "stepId": "coding-recurse-js",
      "mentorSays": "Include element, recurse, remove element (backtrack).",
      "action": "continue",
      "next": "coding-return-js"
    },
    {
      "stepId": "coding-return-js",
      "mentorSays": "Call backtrack(0, []) and return result.",
      "action": "continue",
      "next": "test-code-js"
    },
    {
      "stepId": "test-code-js",
      "mentorSays": "Test cases:\n1. nums=[1,2,2] → [[],[1],[2],[1,2],[2,2],[1,2,2]]\n2. nums=[0] → [[],[0]]\n3. nums=[1,1] → [[],[1],[1,1]]\n4. Verify all subsets are unique\n5. Verify no duplicates in result\n6. Check with [4,4,4,1,4]",
      "example": "",
      "action": "continue",
      "next": "final"
    },
    {
      "stepId": "variable-check-python",
      "mentorSays": "Before we start coding, let me ask: Do you know what a variable is in Python?",
      "choices": [
        {
          "label": "Yes, I know variables",
          "next": "function-check-python"
        },
        {
          "label": "No, explain variables",
          "next": "variable-explanation-python"
        }
      ]
    },
    {
      "stepId": "variable-explanation-python",
      "mentorSays": "A variable is like a labeled box where you can store a value.",
      "example": "let result = [];",
      "action": "continue",
      "next": "function-check-python"
    },
    {
      "stepId": "function-check-python",
      "mentorSays": "Do you know what a function is in Python?",
      "choices": [
        {
          "label": "Yes, I know functions",
          "next": "parameter-check-python"
        },
        {
          "label": "No, explain functions",
          "next": "function-explanation-python"
        }
      ]
    },
    {
      "stepId": "function-explanation-python",
      "mentorSays": "A function is a reusable block of code.",
      "example": "function subsetsWithDup() {}",
      "action": "continue",
      "next": "parameter-check-python"
    },
    {
      "stepId": "parameter-check-python",
      "mentorSays": "Do you know what parameters are?",
      "choices": [
        {
          "label": "Yes, I know parameters",
          "next": "backtracking-check-python"
        },
        {
          "label": "No, explain parameters",
          "next": "parameter-explanation-python"
        }
      ]
    },
    {
      "stepId": "parameter-explanation-python",
      "mentorSays": "Parameters are inputs to a function.",
      "action": "continue",
      "next": "backtracking-check-python"
    },
    {
      "stepId": "backtracking-check-python",
      "mentorSays": "Do you know what backtracking is?",
      "choices": [
        {
          "label": "Yes, I know",
          "next": "coding-start-python"
        },
        {
          "label": "No, explain",
          "next": "backtracking-explanation-python"
        }
      ]
    },
    {
      "stepId": "backtracking-explanation-python",
      "mentorSays": "Backtracking tries choices, explores recursively, backtracks. Skip duplicates at same level.",
      "example": "function backtrack(index, current) { /* skip duplicates */ }",
      "action": "continue",
      "next": "coding-start-python"
    },
    {
      "stepId": "coding-start-python",
      "mentorSays": "Implement subsets II in PYTHON.",
      "example": "function subsetsWithDup(nums) {}",
      "action": "continue",
      "next": "coding-sort-python"
    },
    {
      "stepId": "coding-sort-python",
      "mentorSays": "Sort the array first to group duplicates together.",
      "action": "continue",
      "next": "coding-init-python"
    },
    {
      "stepId": "coding-init-python",
      "mentorSays": "Initialize result array.",
      "action": "continue",
      "next": "coding-helper-python"
    },
    {
      "stepId": "coding-helper-python",
      "mentorSays": "Create backtrack helper function.",
      "action": "continue",
      "next": "coding-base-python"
    },
    {
      "stepId": "coding-base-python",
      "mentorSays": "Add base case: add current subset to result.",
      "action": "continue",
      "next": "coding-loop-python"
    },
    {
      "stepId": "coding-loop-python",
      "mentorSays": "Loop from index to end.",
      "action": "continue",
      "next": "coding-skip-python"
    },
    {
      "stepId": "coding-skip-python",
      "mentorSays": "Skip if same element was used at this level (duplicate check).",
      "action": "continue",
      "next": "coding-recurse-python"
    },
    {
      "stepId": "coding-recurse-python",
      "mentorSays": "Include element, recurse, remove element (backtrack).",
      "action": "continue",
      "next": "coding-return-python"
    },
    {
      "stepId": "coding-return-python",
      "mentorSays": "Call backtrack(0, []) and return result.",
      "action": "continue",
      "next": "test-code-python"
    },
    {
      "stepId": "test-code-python",
      "mentorSays": "Test cases:\n1. nums=[1,2,2] → [[],[1],[2],[1,2],[2,2],[1,2,2]]\n2. nums=[0] → [[],[0]]\n3. nums=[1,1] → [[],[1],[1,1]]\n4. Verify all subsets are unique\n5. Verify no duplicates in result\n6. Check with [4,4,4,1,4]",
      "example": "",
      "action": "continue",
      "next": "final"
    },
    {
      "stepId": "variable-check-java",
      "mentorSays": "Before we start coding, let me ask: Do you know what a variable is in Java?",
      "choices": [
        {
          "label": "Yes, I know variables",
          "next": "function-check-java"
        },
        {
          "label": "No, explain variables",
          "next": "variable-explanation-java"
        }
      ]
    },
    {
      "stepId": "variable-explanation-java",
      "mentorSays": "A variable is like a labeled box where you can store a value.",
      "example": "let result = [];",
      "action": "continue",
      "next": "function-check-java"
    },
    {
      "stepId": "function-check-java",
      "mentorSays": "Do you know what a function is in Java?",
      "choices": [
        {
          "label": "Yes, I know functions",
          "next": "parameter-check-java"
        },
        {
          "label": "No, explain functions",
          "next": "function-explanation-java"
        }
      ]
    },
    {
      "stepId": "function-explanation-java",
      "mentorSays": "A function is a reusable block of code.",
      "example": "function subsetsWithDup() {}",
      "action": "continue",
      "next": "parameter-check-java"
    },
    {
      "stepId": "parameter-check-java",
      "mentorSays": "Do you know what parameters are?",
      "choices": [
        {
          "label": "Yes, I know parameters",
          "next": "backtracking-check-java"
        },
        {
          "label": "No, explain parameters",
          "next": "parameter-explanation-java"
        }
      ]
    },
    {
      "stepId": "parameter-explanation-java",
      "mentorSays": "Parameters are inputs to a function.",
      "action": "continue",
      "next": "backtracking-check-java"
    },
    {
      "stepId": "backtracking-check-java",
      "mentorSays": "Do you know what backtracking is?",
      "choices": [
        {
          "label": "Yes, I know",
          "next": "coding-start-java"
        },
        {
          "label": "No, explain",
          "next": "backtracking-explanation-java"
        }
      ]
    },
    {
      "stepId": "backtracking-explanation-java",
      "mentorSays": "Backtracking tries choices, explores recursively, backtracks. Skip duplicates at same level.",
      "example": "function backtrack(index, current) { /* skip duplicates */ }",
      "action": "continue",
      "next": "coding-start-java"
    },
    {
      "stepId": "coding-start-java",
      "mentorSays": "Implement subsets II in JAVA.",
      "example": "function subsetsWithDup(nums) {}",
      "action": "continue",
      "next": "coding-sort-java"
    },
    {
      "stepId": "coding-sort-java",
      "mentorSays": "Sort the array first to group duplicates together.",
      "action": "continue",
      "next": "coding-init-java"
    },
    {
      "stepId": "coding-init-java",
      "mentorSays": "Initialize result array.",
      "action": "continue",
      "next": "coding-helper-java"
    },
    {
      "stepId": "coding-helper-java",
      "mentorSays": "Create backtrack helper function.",
      "action": "continue",
      "next": "coding-base-java"
    },
    {
      "stepId": "coding-base-java",
      "mentorSays": "Add base case: add current subset to result.",
      "action": "continue",
      "next": "coding-loop-java"
    },
    {
      "stepId": "coding-loop-java",
      "mentorSays": "Loop from index to end.",
      "action": "continue",
      "next": "coding-skip-java"
    },
    {
      "stepId": "coding-skip-java",
      "mentorSays": "Skip if same element was used at this level (duplicate check).",
      "action": "continue",
      "next": "coding-recurse-java"
    },
    {
      "stepId": "coding-recurse-java",
      "mentorSays": "Include element, recurse, remove element (backtrack).",
      "action": "continue",
      "next": "coding-return-java"
    },
    {
      "stepId": "coding-return-java",
      "mentorSays": "Call backtrack(0, []) and return result.",
      "action": "continue",
      "next": "test-code-java"
    },
    {
      "stepId": "test-code-java",
      "mentorSays": "Test cases:\n1. nums=[1,2,2] → [[],[1],[2],[1,2],[2,2],[1,2,2]]\n2. nums=[0] → [[],[0]]\n3. nums=[1,1] → [[],[1],[1,1]]\n4. Verify all subsets are unique\n5. Verify no duplicates in result\n6. Check with [4,4,4,1,4]",
      "example": "",
      "action": "continue",
      "next": "final"
    },
    {
      "stepId": "variable-check-cpp",
      "mentorSays": "Before we start coding, let me ask: Do you know what a variable is in C++?",
      "choices": [
        {
          "label": "Yes, I know variables",
          "next": "function-check-cpp"
        },
        {
          "label": "No, explain variables",
          "next": "variable-explanation-cpp"
        }
      ]
    },
    {
      "stepId": "variable-explanation-cpp",
      "mentorSays": "A variable is like a labeled box where you can store a value.",
      "example": "let result = [];",
      "action": "continue",
      "next": "function-check-cpp"
    },
    {
      "stepId": "function-check-cpp",
      "mentorSays": "Do you know what a function is in C++?",
      "choices": [
        {
          "label": "Yes, I know functions",
          "next": "parameter-check-cpp"
        },
        {
          "label": "No, explain functions",
          "next": "function-explanation-cpp"
        }
      ]
    },
    {
      "stepId": "function-explanation-cpp",
      "mentorSays": "A function is a reusable block of code.",
      "example": "function subsetsWithDup() {}",
      "action": "continue",
      "next": "parameter-check-cpp"
    },
    {
      "stepId": "parameter-check-cpp",
      "mentorSays": "Do you know what parameters are?",
      "choices": [
        {
          "label": "Yes, I know parameters",
          "next": "backtracking-check-cpp"
        },
        {
          "label": "No, explain parameters",
          "next": "parameter-explanation-cpp"
        }
      ]
    },
    {
      "stepId": "parameter-explanation-cpp",
      "mentorSays": "Parameters are inputs to a function.",
      "action": "continue",
      "next": "backtracking-check-cpp"
    },
    {
      "stepId": "backtracking-check-cpp",
      "mentorSays": "Do you know what backtracking is?",
      "choices": [
        {
          "label": "Yes, I know",
          "next": "coding-start-cpp"
        },
        {
          "label": "No, explain",
          "next": "backtracking-explanation-cpp"
        }
      ]
    },
    {
      "stepId": "backtracking-explanation-cpp",
      "mentorSays": "Backtracking tries choices, explores recursively, backtracks. Skip duplicates at same level.",
      "example": "function backtrack(index, current) { /* skip duplicates */ }",
      "action": "continue",
      "next": "coding-start-cpp"
    },
    {
      "stepId": "coding-start-cpp",
      "mentorSays": "Implement subsets II in CPP.",
      "example": "function subsetsWithDup(nums) {}",
      "action": "continue",
      "next": "coding-sort-cpp"
    },
    {
      "stepId": "coding-sort-cpp",
      "mentorSays": "Sort the array first to group duplicates together.",
      "action": "continue",
      "next": "coding-init-cpp"
    },
    {
      "stepId": "coding-init-cpp",
      "mentorSays": "Initialize result array.",
      "action": "continue",
      "next": "coding-helper-cpp"
    },
    {
      "stepId": "coding-helper-cpp",
      "mentorSays": "Create backtrack helper function.",
      "action": "continue",
      "next": "coding-base-cpp"
    },
    {
      "stepId": "coding-base-cpp",
      "mentorSays": "Add base case: add current subset to result.",
      "action": "continue",
      "next": "coding-loop-cpp"
    },
    {
      "stepId": "coding-loop-cpp",
      "mentorSays": "Loop from index to end.",
      "action": "continue",
      "next": "coding-skip-cpp"
    },
    {
      "stepId": "coding-skip-cpp",
      "mentorSays": "Skip if same element was used at this level (duplicate check).",
      "action": "continue",
      "next": "coding-recurse-cpp"
    },
    {
      "stepId": "coding-recurse-cpp",
      "mentorSays": "Include element, recurse, remove element (backtrack).",
      "action": "continue",
      "next": "coding-return-cpp"
    },
    {
      "stepId": "coding-return-cpp",
      "mentorSays": "Call backtrack(0, []) and return result.",
      "action": "continue",
      "next": "test-code-cpp"
    },
    {
      "stepId": "test-code-cpp",
      "mentorSays": "Test cases:\n1. nums=[1,2,2] → [[],[1],[2],[1,2],[2,2],[1,2,2]]\n2. nums=[0] → [[],[0]]\n3. nums=[1,1] → [[],[1],[1,1]]\n4. Verify all subsets are unique\n5. Verify no duplicates in result\n6. Check with [4,4,4,1,4]",
      "example": "",
      "action": "continue",
      "next": "final"
    },
    {
      "stepId": "variable-check-ts",
      "mentorSays": "Before we start coding, let me ask: Do you know what a variable is in TypeScript?",
      "choices": [
        {
          "label": "Yes, I know variables",
          "next": "function-check-ts"
        },
        {
          "label": "No, explain variables",
          "next": "variable-explanation-ts"
        }
      ]
    },
    {
      "stepId": "variable-explanation-ts",
      "mentorSays": "A variable is like a labeled box where you can store a value.",
      "example": "let result = [];",
      "action": "continue",
      "next": "function-check-ts"
    },
    {
      "stepId": "function-check-ts",
      "mentorSays": "Do you know what a function is in TypeScript?",
      "choices": [
        {
          "label": "Yes, I know functions",
          "next": "parameter-check-ts"
        },
        {
          "label": "No, explain functions",
          "next": "function-explanation-ts"
        }
      ]
    },
    {
      "stepId": "function-explanation-ts",
      "mentorSays": "A function is a reusable block of code.",
      "example": "function subsetsWithDup() {}",
      "action": "continue",
      "next": "parameter-check-ts"
    },
    {
      "stepId": "parameter-check-ts",
      "mentorSays": "Do you know what parameters are?",
      "choices": [
        {
          "label": "Yes, I know parameters",
          "next": "backtracking-check-ts"
        },
        {
          "label": "No, explain parameters",
          "next": "parameter-explanation-ts"
        }
      ]
    },
    {
      "stepId": "parameter-explanation-ts",
      "mentorSays": "Parameters are inputs to a function.",
      "action": "continue",
      "next": "backtracking-check-ts"
    },
    {
      "stepId": "backtracking-check-ts",
      "mentorSays": "Do you know what backtracking is?",
      "choices": [
        {
          "label": "Yes, I know",
          "next": "coding-start-ts"
        },
        {
          "label": "No, explain",
          "next": "backtracking-explanation-ts"
        }
      ]
    },
    {
      "stepId": "backtracking-explanation-ts",
      "mentorSays": "Backtracking tries choices, explores recursively, backtracks. Skip duplicates at same level.",
      "example": "function backtrack(index, current) { /* skip duplicates */ }",
      "action": "continue",
      "next": "coding-start-ts"
    },
    {
      "stepId": "coding-start-ts",
      "mentorSays": "Implement subsets II in TS.",
      "example": "function subsetsWithDup(nums) {}",
      "action": "continue",
      "next": "coding-sort-ts"
    },
    {
      "stepId": "coding-sort-ts",
      "mentorSays": "Sort the array first to group duplicates together.",
      "action": "continue",
      "next": "coding-init-ts"
    },
    {
      "stepId": "coding-init-ts",
      "mentorSays": "Initialize result array.",
      "action": "continue",
      "next": "coding-helper-ts"
    },
    {
      "stepId": "coding-helper-ts",
      "mentorSays": "Create backtrack helper function.",
      "action": "continue",
      "next": "coding-base-ts"
    },
    {
      "stepId": "coding-base-ts",
      "mentorSays": "Add base case: add current subset to result.",
      "action": "continue",
      "next": "coding-loop-ts"
    },
    {
      "stepId": "coding-loop-ts",
      "mentorSays": "Loop from index to end.",
      "action": "continue",
      "next": "coding-skip-ts"
    },
    {
      "stepId": "coding-skip-ts",
      "mentorSays": "Skip if same element was used at this level (duplicate check).",
      "action": "continue",
      "next": "coding-recurse-ts"
    },
    {
      "stepId": "coding-recurse-ts",
      "mentorSays": "Include element, recurse, remove element (backtrack).",
      "action": "continue",
      "next": "coding-return-ts"
    },
    {
      "stepId": "coding-return-ts",
      "mentorSays": "Call backtrack(0, []) and return result.",
      "action": "continue",
      "next": "test-code-ts"
    },
    {
      "stepId": "test-code-ts",
      "mentorSays": "Test cases:\n1. nums=[1,2,2] → [[],[1],[2],[1,2],[2,2],[1,2,2]]\n2. nums=[0] → [[],[0]]\n3. nums=[1,1] → [[],[1],[1,1]]\n4. Verify all subsets are unique\n5. Verify no duplicates in result\n6. Check with [4,4,4,1,4]",
      "example": "",
      "action": "continue",
      "next": "final"
    },
    {
      "stepId": "final",
      "mentorSays": "Time: O(2^n), Space: O(n). Sort first, then skip duplicates at same level during backtracking.",
      "action": "continue"
    }
  ]
}