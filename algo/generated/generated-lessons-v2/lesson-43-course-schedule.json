{
  "id": "course-schedule",
  "title": "Course Schedule",
  "pattern": "topological sort (cycle detection)",
  "difficulty": "medium",
  "language": "javascript",
  "status": "AI-GENERATED-V2-DIRECT",
  "standardsVersion": "lessonStandards.v2-inpact",
  "curriculum": {
    "lessonNumber": 43,
    "tier": "ADVANCED",
    "lessonOrderTag": "ADVANCED-43",
    "introduces": ["directed-graph", "topological-sort", "cycle-detection", "graph-states"],
    "assumesAlreadyTaught": ["graph-concept", "DFS-on-grid", "arrays"],
    "prerequisiteCheckRequired": true,
    "nextRecommended": ["course-schedule-ii"]
  },
  "pseudocode": [
    {"id": "ps1", "text": "Create adjacency list from prerequisites"},
    {"id": "ps2", "text": "Track three states: unvisited, visiting, visited"},
    {"id": "ps3", "text": "For each unvisited course, start DFS"},
    {"id": "ps4", "text": "Mark current course as 'visiting'"},
    {"id": "ps5", "text": "Recursively visit all prerequisites"},
    {"id": "ps6", "text": "If we encounter 'visiting' node, cycle detected!"},
    {"id": "ps7", "text": "After visiting all prerequisites, mark as 'visited'"},
    {"id": "ps8", "text": "Return true if no cycles, false if cycle found"}
  ],
  "flow": [
    {
      "stepId": "objectives",
      "mentorSays": "Hey! Ready for **Course Schedule** - your first cycle detection problem!\n\nThis teaches you **topological sort** and how to detect cycles in directed graphs using the **three-state DFS** pattern.\n\nYou'll learn:\nâ€¢ How to model dependencies as a directed graph\nâ€¢ Detecting cycles using visiting/visited states\nâ€¢ Topological sort foundations\n\nLet's dive in!",
      "action": "continue",
      "next": "language-selection"
    },
    {
      "stepId": "language-selection",
      "mentorSays": "Before we dive into the problem, which programming language would you like to use?\n\nThis will help me make sure you have the right building blocks.",
      "choices": [
        {"label": "ğŸ’› JavaScript", "next": "prereq-check-js"},
        {"label": "ğŸ Python", "next": "prereq-check-python"},
        {"label": "â˜• Java", "next": "prereq-check-java"},
        {"label": "âš¡ C++", "next": "prereq-check-cpp"},
        {"label": "ğŸ’™ TypeScript", "next": "prereq-check-ts"}
      ]
    },
    {"stepId": "prereq-check-js", "mentorSays": "Great choice! Before we tackle this problem, let me make sure you have the building blocks.\n\nTo solve this in JavaScript, you'll need to know:\n- **Graph concept** - Understanding nodes and edges\n- **DFS on grid** - Similar recursive pattern\n- **Arrays** - Building and using adjacency lists\n\nDo you feel confident with these JavaScript concepts?", "choices": [{"label": "Yes, I know all of them", "next": "problem-understanding"}, {"label": "No, please explain them", "next": "teach-prereqs-js"}, {"label": "I know some, not all", "next": "select-prereqs-js"}]},
    {"stepId": "teach-prereqs-js", "mentorSays": "I'll teach you the prerequisites you need. [Full interactive teaching will be added in Phase 2]\n\nFor now, let's continue with the lesson!", "action": "continue", "next": "problem-understanding"},
    {"stepId": "select-prereqs-js", "mentorSays": "Which concepts would you like me to explain? [Individual selection will be added in Phase 2]\n\nFor now, let's continue!", "action": "continue", "next": "problem-understanding"},
    {"stepId": "prereq-check-python", "mentorSays": "Great choice! Before we tackle this problem, let me make sure you have the building blocks.\n\nTo solve this in Python, you'll need to know:\n- **Graph concept** - Understanding nodes and edges\n- **DFS on grid** - Similar recursive pattern\n- **Arrays** - Building and using adjacency lists\n\nDo you feel confident with these Python concepts?", "choices": [{"label": "Yes, I know all of them", "next": "problem-understanding"}, {"label": "No, please explain them", "next": "teach-prereqs-python"}, {"label": "I know some, not all", "next": "select-prereqs-python"}]},
    {"stepId": "teach-prereqs-python", "mentorSays": "I'll teach you the prerequisites you need. [Full interactive teaching will be added in Phase 2]\n\nFor now, let's continue with the lesson!", "action": "continue", "next": "problem-understanding"},
    {"stepId": "select-prereqs-python", "mentorSays": "Which concepts would you like me to explain? [Individual selection will be added in Phase 2]\n\nFor now, let's continue!", "action": "continue", "next": "problem-understanding"},
    {"stepId": "prereq-check-java", "mentorSays": "Great choice! Before we tackle this problem, let me make sure you have the building blocks.\n\nTo solve this in Java, you'll need to know:\n- **Graph concept** - Understanding nodes and edges\n- **DFS on grid** - Similar recursive pattern\n- **Arrays** - Building and using adjacency lists\n\nDo you feel confident with these Java concepts?", "choices": [{"label": "Yes, I know all of them", "next": "problem-understanding"}, {"label": "No, please explain them", "next": "teach-prereqs-java"}, {"label": "I know some, not all", "next": "select-prereqs-java"}]},
    {"stepId": "teach-prereqs-java", "mentorSays": "I'll teach you the prerequisites you need. [Full interactive teaching will be added in Phase 2]\n\nFor now, let's continue with the lesson!", "action": "continue", "next": "problem-understanding"},
    {"stepId": "select-prereqs-java", "mentorSays": "Which concepts would you like me to explain? [Individual selection will be added in Phase 2]\n\nFor now, let's continue!", "action": "continue", "next": "problem-understanding"},
    {"stepId": "prereq-check-cpp", "mentorSays": "Great choice! Before we tackle this problem, let me make sure you have the building blocks.\n\nTo solve this in C++, you'll need to know:\n- **Graph concept** - Understanding nodes and edges\n- **DFS on grid** - Similar recursive pattern\n- **Arrays** - Building and using adjacency lists\n\nDo you feel confident with these C++ concepts?", "choices": [{"label": "Yes, I know all of them", "next": "problem-understanding"}, {"label": "No, please explain them", "next": "teach-prereqs-cpp"}, {"label": "I know some, not all", "next": "select-prereqs-cpp"}]},
    {"stepId": "teach-prereqs-cpp", "mentorSays": "I'll teach you the prerequisites you need. [Full interactive teaching will be added in Phase 2]\n\nFor now, let's continue with the lesson!", "action": "continue", "next": "problem-understanding"},
    {"stepId": "select-prereqs-cpp", "mentorSays": "Which concepts would you like me to explain? [Individual selection will be added in Phase 2]\n\nFor now, let's continue!", "action": "continue", "next": "problem-understanding"},
    {"stepId": "prereq-check-ts", "mentorSays": "Great choice! Before we tackle this problem, let me make sure you have the building blocks.\n\nTo solve this in TypeScript, you'll need to know:\n- **Graph concept** - Understanding nodes and edges\n- **DFS on grid** - Similar recursive pattern\n- **Arrays** - Building and using adjacency lists\n\nDo you feel confident with these TypeScript concepts?", "choices": [{"label": "Yes, I know all of them", "next": "problem-understanding"}, {"label": "No, please explain them", "next": "teach-prereqs-ts"}, {"label": "I know some, not all", "next": "select-prereqs-ts"}]},
    {"stepId": "teach-prereqs-ts", "mentorSays": "I'll teach you the prerequisites you need. [Full interactive teaching will be added in Phase 2]\n\nFor now, let's continue with the lesson!", "action": "continue", "next": "problem-understanding"},
    {"stepId": "select-prereqs-ts", "mentorSays": "Which concepts would you like me to explain? [Individual selection will be added in Phase 2]\n\nFor now, let's continue!", "action": "continue", "next": "problem-understanding"},
    {
      "stepId": "problem-understanding",
      "mentorSays": "Perfect! Now let's understand what this problem asks for.\n\n**Imagine you're planning your college courses.** Some courses have prerequisites - you must take Course A before Course B. Can you complete all courses, or are there circular dependencies that make it impossible?\n\nGiven:\n- `numCourses`: total number of courses (labeled 0 to numCourses-1)\n- `prerequisites`: array of pairs `[a, b]` meaning you must take course `b` before course `a`\n\nReturn `true` if you can finish all courses, `false` otherwise.\n\nExample:\n```\nnumCourses = 2\nprerequisites = [[1,0]]\n```\nOutput: `true` (take course 0, then course 1)\n\n```\nnumCourses = 2  \nprerequisites = [[1,0],[0,1]]\n```\nOutput: `false` (circular dependency!)",
      "action": "continue",
      "next": "thinking-challenge"
    },
    {
      "stepId": "thinking-challenge",
      "mentorSays": "When can't we complete all courses?\n\nThink about circular dependencies...",
      "choices": [
        {"label": "When there are too many prerequisites", "next": "wrong-choice"},
        {"label": "When there's a cycle in the dependency graph", "next": "core-idea"}
      ]
    },
    {
      "stepId": "wrong-choice",
      "mentorSays": "Number of prerequisites doesn't matter - we can take courses one at a time!\n\nThe problem is **cycles**: Course A requires B, B requires C, C requires A. You can never start because every course needs another one first!",
      "action": "next",
      "next": "core-idea"
    },
    {
      "stepId": "core-idea",
      "mentorSays": "The key insight is: **detect cycles using three-state DFS**.\n\nWe track each course as:\n- **0 (unvisited)** - haven't checked yet\n- **1 (visiting)** - currently exploring this path\n- **2 (visited)** - finished, no cycles found\n\nDuring DFS:\n1. Mark current course as **visiting**\n2. Visit all its prerequisites\n3. If we encounter a **visiting** course â†’ **cycle detected!**\n4. After checking all prerequisites, mark as **visited**\n\nIf we find any cycle, return false. Otherwise, all courses can be completed!",
      "action": "next",
      "next": "walkthrough",
      "pseudocodeLineIds": ["ps1", "ps2", "ps3"]
    },
    {
      "stepId": "walkthrough",
      "mentorSays": "Let's trace through `numCourses=4`, `prerequisites=[[1,0],[2,1],[3,2]]`:\n\n- Build graph: 0â†’[], 1â†’[0], 2â†’[1], 3â†’[2]\n- **Start DFS(0):** Mark 0 as visiting, no prereqs, mark visited âœ“\n- **DFS(1):** Mark 1 as visiting, visit 0 (already visited), mark 1 visited âœ“\n- **DFS(2):** Mark 2 as visiting, visit 1 (already visited), mark 2 visited âœ“\n- **DFS(3):** Mark 3 as visiting, visit 2 (already visited), mark 3 visited âœ“\n- **No cycles found!** Return `true`\n\nFor cycle example `[[1,0],[0,1]]`:\n- **DFS(0):** Mark 0 visiting, visit 1\n  - **DFS(1):** Mark 1 visiting, visit 0\n    - **0 is visiting!** CYCLE â†’ return `false`",
      "action": "next",
      "next": "pseudocode-step",
      "pseudocodeLineIds": ["ps1", "ps2", "ps3"]
    },
    {"stepId": "pseudocode-step", "mentorSays": "Here's our plan written as pseudocode:", "action": "next", "next": "coding-intro", "pseudocodeLineIds": ["ps1", "ps2", "ps3", "ps4", "ps5", "ps6", "ps7", "ps8"]},
    {"stepId": "coding-intro", "mentorSays": "Now let's translate this into JavaScript, building it step by step.\n\nRemember: we'll add just 1-3 lines at a time!", "action": "next", "next": "code-01"},
    {"stepId": "code-01", "mentorSays": "Build adjacency list from prerequisites.\n\n```javascript\nfunction canFinish(numCourses, prerequisites) {\n  const graph = Array.from({length: numCourses}, () => []);\n  for (const [course, prereq] of prerequisites) {\n    graph[course].push(prereq);\n  }\n}\n```", "action": "next", "next": "code-02", "pseudocodeLineIds": ["ps1"], "example": "const graph = Array.from({length: numCourses}, () => []);\nfor (const [course, prereq] of prerequisites) graph[course].push(prereq);"
    },
    {"stepId": "code-02", "mentorSays": "Create state array: 0=unvisited, 1=visiting, 2=visited.\n\n```javascript\nfunction canFinish(numCourses, prerequisites) {\n  const graph = Array.from({length: numCourses}, () => []);\n  for (const [course, prereq] of prerequisites) {\n    graph[course].push(prereq);\n  }\n  \n  const state = Array(numCourses).fill(0);\n}\n```", "action": "next", "next": "code-03", "pseudocodeLineIds": ["ps2"], "example": "const state = Array(numCourses).fill(0);"
    },
    {"stepId": "code-03", "mentorSays": "Define DFS function to detect cycles.\n\n```javascript\nfunction canFinish(numCourses, prerequisites) {\n  const graph = Array.from({length: numCourses}, () => []);\n  for (const [course, prereq] of prerequisites) {\n    graph[course].push(prereq);\n  }\n  \n  const state = Array(numCourses).fill(0);\n  \n  const hasCycle = (course) => {\n    if (state[course] === 1) return true;\n    if (state[course] === 2) return false;\n  };\n}\n```", "action": "next", "next": "code-04", "pseudocodeLineIds": ["ps4", "ps6"], "example": "const hasCycle = (course) => {\n  if (state[course] === 1) return true;\n  if (state[course] === 2) return false;"
    },
    {"stepId": "code-04", "mentorSays": "Mark as visiting and check all prerequisites.\n\n```javascript\nfunction canFinish(numCourses, prerequisites) {\n  const graph = Array.from({length: numCourses}, () => []);\n  for (const [course, prereq] of prerequisites) {\n    graph[course].push(prereq);\n  }\n  \n  const state = Array(numCourses).fill(0);\n  \n  const hasCycle = (course) => {\n    if (state[course] === 1) return true;\n    if (state[course] === 2) return false;\n    \n    state[course] = 1;\n    for (const prereq of graph[course]) {\n      if (hasCycle(prereq)) return true;\n    }\n  };\n}\n```", "action": "next", "next": "code-05", "pseudocodeLineIds": ["ps4", "ps5", "ps6"], "example": "state[course] = 1;\nfor (const prereq of graph[course]) {\n  if (hasCycle(prereq)) return true;"
    },
    {"stepId": "code-05", "mentorSays": "After checking all prerequisites, mark as visited.\n\n```javascript\nfunction canFinish(numCourses, prerequisites) {\n  const graph = Array.from({length: numCourses}, () => []);\n  for (const [course, prereq] of prerequisites) {\n    graph[course].push(prereq);\n  }\n  \n  const state = Array(numCourses).fill(0);\n  \n  const hasCycle = (course) => {\n    if (state[course] === 1) return true;\n    if (state[course] === 2) return false;\n    \n    state[course] = 1;\n    for (const prereq of graph[course]) {\n      if (hasCycle(prereq)) return true;\n    }\n    state[course] = 2;\n    return false;\n  };\n}\n```", "action": "next", "next": "code-06", "pseudocodeLineIds": ["ps7"], "example": "state[course] = 2;\nreturn false;"
    },
    {"stepId": "code-06", "mentorSays": "Check all courses for cycles.\n\n```javascript\nfunction canFinish(numCourses, prerequisites) {\n  const graph = Array.from({length: numCourses}, () => []);\n  for (const [course, prereq] of prerequisites) {\n    graph[course].push(prereq);\n  }\n  \n  const state = Array(numCourses).fill(0);\n  \n  const hasCycle = (course) => {\n    if (state[course] === 1) return true;\n    if (state[course] === 2) return false;\n    \n    state[course] = 1;\n    for (const prereq of graph[course]) {\n      if (hasCycle(prereq)) return true;\n    }\n    state[course] = 2;\n    return false;\n  };\n  \n  for (let i = 0; i < numCourses; i++) {\n    if (hasCycle(i)) return false;\n  }\n  \n  return true;\n}\n```", "action": "next", "next": "wrap-up", "pseudocodeLineIds": ["ps3", "ps8"], "example": "for (let i = 0; i < numCourses; i++) {\n  if (hasCycle(i)) return false;\n}\nreturn true;"
    },
    {
      "stepId": "wrap-up",
      "mentorSays": "Excellent work! You've mastered **cycle detection** and the **three-state DFS** pattern!\n\nThis technique is crucial for:\nâ€¢ Detecting deadlocks\nâ€¢ Validating dependency graphs\nâ€¢ Topological sorting\n\nNext: **Course Schedule II** - where we'll actually compute the valid course order!\n\nKeep going! ğŸš€",
      "action": "complete"
    }
  ]
}
